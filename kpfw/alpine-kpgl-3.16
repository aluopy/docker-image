FROM aluopy/alpine-glibc:3.16
MAINTAINER aluopy <aluopy@qq.com>

# Java Version
ENV JAVA_VERSION_MAJOR 8
ENV JAVA_VERSION_MINOR 351
ENV JAVA_VERSION_BUILD 10
ENV JAVA_URL_ELEMENT   10e8cce67c7843478f41411b7003171c
ENV JAVA_PACKAGE       jdk
ENV JAVA_SHA256_SUM    f909ca3041613e777cbd67a58808e63b5ad6bf6cfa4f9c5ee712fc878634dc1d

# Tomcat Version
ENV TOMCAT_VERSION_MAJOR 9
ENV TOMCAT_VERSION_FULL  9.0.68

# Download and install
# otn-pub --> otn
RUN wget --no-check-certificate -c --header "Cookie: oraclelicense=accept-securebackup-cookie" -O java.tar.gz\
    http://download.oracle.com/otn/java/jdk/${JAVA_VERSION_MAJOR}u${JAVA_VERSION_MINOR}-b${JAVA_VERSION_BUILD}/${JAVA_URL_ELEMENT}/${JAVA_PACKAGE}-${JAVA_VERSION_MAJOR}u${JAVA_VERSION_MINOR}-linux-x64.tar.gz && \
    echo "$JAVA_SHA256_SUM  java.tar.gz" | sha256sum -c - && \
    gunzip -c java.tar.gz | tar -xf - -C /usr/local && rm -f java.tar.gz && \
    ln -s /usr/local/${JAVA_PACKAGE}1.${JAVA_VERSION_MAJOR}.0_${JAVA_VERSION_MINOR} /usr/local/${JAVA_PACKAGE} && \
    rm -rf /usr/local/jdk/COPYRIGHT \
           /usr/local/jdk/jmc.txt \
           /usr/local/jdk/LICENSE \
           /usr/local/jdk/README.html \
           /usr/local/jdk/release \
           /usr/local/jdk/THIRDPARTYLICENSEREADME-JAVAFX.txt \
           /usr/local/jdk/THIRDPARTYLICENSEREADME.txt \
           /usr/local/jdk/jre/COPYRIGHT \
           /usr/local/jdk/jre/LICENSE \
           /usr/local/jdk/jre/README \
           /usr/local/jdk/jre/THIRDPARTYLICENSEREADME-JAVAFX.txt \
           /usr/local/jdk/jre/THIRDPARTYLICENSEREADME.txt \
           /usr/local/jdk/jre/Welcome.html \
           /usr/local/jdk/*src.zip \
           /usr/local/jdk/lib/missioncontrol \
           /usr/local/jdk/lib/visualvm \
           /usr/local/jdk/lib/*javafx* \
           /usr/local/jdk/jre/lib/plugin.jar \
           /usr/local/jdk/jre/lib/ext/jfxrt.jar \
           /usr/local/jdk/jre/bin/javaws \
           /usr/local/jdk/jre/lib/javaws.jar \
           /usr/local/jdk/jre/lib/desktop \
           /usr/local/jdk/jre/plugin \
           /usr/local/jdk/jre/lib/deploy* \
           /usr/local/jdk/jre/lib/*javafx* \
           /usr/local/jdk/jre/lib/*jfx* \
           /usr/local/jdk/jre/lib/amd64/libdecora_sse.so \
           /usr/local/jdk/jre/lib/amd64/libprism_*.so \
           /usr/local/jdk/jre/lib/amd64/libfxplugins.so \
           /usr/local/jdk/jre/lib/amd64/libglass.so \
           /usr/local/jdk/jre/lib/amd64/libgstreamer-lite.so \
           /usr/local/jdk/jre/lib/amd64/libjavafx*.so \
           /usr/local/jdk/jre/lib/amd64/libjfx*.so && \
    wget http://mirrors.standaloneinstaller.com/apache/tomcat/tomcat-${TOMCAT_VERSION_MAJOR}/v${TOMCAT_VERSION_FULL}/bin/apache-tomcat-${TOMCAT_VERSION_FULL}.tar.gz && \
    wget https://www.apache.org/dist/tomcat/tomcat-${TOMCAT_VERSION_MAJOR}/v${TOMCAT_VERSION_FULL}/bin/apache-tomcat-${TOMCAT_VERSION_FULL}.tar.gz.sha512 && \
    sha512sum -c apache-tomcat-${TOMCAT_VERSION_FULL}.tar.gz.sha512 && \
    mkdir /apps /home/sdzfp -p && \
    gunzip -c apache-tomcat-${TOMCAT_VERSION_FULL}.tar.gz | tar -xf - -C /apps && \
    mv /apps/apache-tomcat-${TOMCAT_VERSION_FULL} /apps/tomcat && \
    rm -f apache-tomcat-${TOMCAT_VERSION_FULL}.tar.gz apache-tomcat-${TOMCAT_VERSION_FULL}.tar.gz.sha512 && \
    ln -s /apps/tomcat /home/sdzfp/dtomcat-kpgl-8081 && \
    rm -rf /apps/tomcat/webapps/* \
           /apps/tomcat/BUILDING.txt \
           /apps/tomcat/*.md \
           /apps/tomcat/LICENSE \
           /apps/tomcat/NOTICE \
           /apps/tomcat/RELEASE-NOTES \
           /apps/tomcat/RUNNING.txt

# Configuration
#ADD tomcat-users.xml /apps/tomcat/conf/
#RUN sed -i 's/52428800/5242880000/g' /apps/tomcat/webapps/manager/WEB-INF/web.xml 

# Set environment
ENV JAVA_HOME /usr/local/${JAVA_PACKAGE}
ENV PATH ${PATH}:${JAVA_HOME}/bin
ENV CATALINA_HOME /apps/tomcat
#ENV APP_DIR=${CATALINA_HOME}/webapps

# Expose web port
EXPOSE 8080

# Launch Tomcat on startup
#CMD ${CATALINA_HOME}/bin/catalina.sh run
